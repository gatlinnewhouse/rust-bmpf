use rand::random;

fn erfinv(x: f32) -> f32 {
    assert!(0.0 <= x && x < 1.0);
    if x <= 0.4 {
        return -0.003241691 + x * 0.922235728;
    }
    if x <= 0.9 {
        return 0.369856315 + x * (-0.598012907 + x * 1.602813513);
    }
    if x <= 0.99 {
        return -694.991315729 + x * (2257.764033265 + x * (-2444.745829241 + x * 883.953153923));
    }
    if x <= 0.999 {
        return -717260.870032080
            + x * (2168591.882440044 + x * (-2185555.532633572 + x * 734226.973095943));
    }
    return 1.786158859307387 + 0.004 * ((x - 0.99) * 600.0).exp();
}

pub fn gaussian(sd: f32) -> f32 {
    let r = random::<i32>();
    let y = erfinv((r & !1) as f32 / (i32::MAX as f32 - 1.0f32));
    if r & 1 == 1 {
        return -y * sd;
    }
    return y * sd;
}
